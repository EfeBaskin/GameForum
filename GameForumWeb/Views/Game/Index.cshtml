@model IEnumerable<GameForumWeb.Models.Game>
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_GameForumLayout.cshtml";
}

<h2>Games</h2>

<form method="get" action="@Url.Action("Index", "Game")">
    <select name="platform" onchange="this.form.submit()" class="select-box" style="width: 100px">
        <option value="All" @(ViewBag.SelectedPlatform == "All" ? "selected" : "")>All</option>
        <option value="PS" @(ViewBag.SelectedPlatform == "PS" ? "selected" : "")>PS</option>
        <option value="PC" @(ViewBag.SelectedPlatform == "PC" ? "selected" : "")>PC</option>
    </select>
</form>

<div class="game-list">
    @foreach (var game in Model)
    {
        <div class="game-card" data-game-id="@game.Id">
            <img src="@game.ImageUrl" alt="Game Image" class="game-image">
            <h3>@game.GameName</h3>
            <p>Platform: @game.Platform</p>
            <button class="bookmark-btn">Bookmark</button>
            <button class="reviews-btn">Reviews</button>
            <button class="delete-btn" onclick="deleteGame(@game.Id)">Delete</button>
        </div>
    }
</div>
<style>
    .game-card {
        transition: all 0.3s ease;
    }

    .hidden {
        height: 0;
        opacity: 0;
        margin: 0;
        padding: 0;
        overflow: hidden;
    }
</style>
<script>
    function deleteGame(gameId) {
        if (confirm("Are you sure you want to delete this game?"))
        {
            fetch(`@Url.Action("Delete", "Game")`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ id: gameId })
            })
            .then(response => {
                if (response.ok)
                {
                    const gameCard = document.querySelector(`.game-card[data-game-id="${gameId}"]`);
                    if (gameCard) {
                        gameCard.classList.add('hidden'); // Add hidden class to trigger CSS transition
                        setTimeout(() => {
                            gameCard.remove(); // Remove card after the transition
                        }, 300); // Match this timeout to the transition duration
                    }
                }
                else
                {
                    alert("Error deleting game. Please try again.");
                }
            })
            .catch(error => {
                alert("Error deleting game. Please try again.");
                console.error('Error:', error);
            });
        }
    }
</script>
